<form [formGroup]="truckForm" (ngSubmit)="onSubmit()">
  <div class="card">
    <h1>{{ isEditMode ? 'Editar Caminhão' : 'Cadastrar Caminhão' }}</h1>

    <div class="field" *ngIf="truckForm.get('licensePlate') as plate">
      <label for="licensePlate">Placa</label>
      <input
        id="licensePlate"
        type="text"
        formControlName="licensePlate"
        maxlength="7"
        autocomplete="off"
        inputmode="latin-prose"
        aria-describedby="plateHelp plateError"
      />
      <small id="plateHelp" class="hint">
        Formatos aceitos: <strong>ABC1234</strong> (antigo) ou <strong>ABC1D23</strong> (Mercosul).
      </small>
      <div id="plateError" class="error" *ngIf="plate.invalid && (plate.dirty || plate.touched)">
        <span *ngIf="plate.errors?.['required']">Placa é obrigatória.</span>
        <span *ngIf="plate.errors?.['minlength'] || plate.errors?.['maxlength']">
          A placa deve conter exatamente 7 caracteres.
        </span>
        <span *ngIf="plate.errors?.['pattern']">
          Use <strong>ABC1234</strong> ou <strong>ABC1D23</strong>.
        </span>
      </div>
    </div>

    <div class="grid grid-2">
      <div class="field">
        <label for="brand">Marca</label>
        <select id="brand" formControlName="brand">
          <option value="">Selecione</option>
          <option *ngFor="let b of brands" [value]="b.codigo">{{ b.nome }}</option>
        </select>
      </div>

      <div class="field">
        <label for="model">Modelo</label>
        <select id="model" formControlName="model" [disabled]="!models.length">
          <option value="">Selecione</option>
          <option *ngFor="let m of models" [value]="m.codigo">{{ m.nome }}</option>
        </select>
      </div>

      <div class="field">
        <label for="yearCode">Ano</label>
        <select id="yearCode" formControlName="yearCode" [disabled]="!years.length">
          <option value="">Selecione</option>
          <option *ngFor="let y of years" [value]="y.codigo">{{ y.nome }}</option>
        </select>
      </div>

      <div class="field">
        <label for="manufacturingYear">Ano de fabricação</label>
        <input id="manufacturingYear" type="number" formControlName="manufacturingYear" readonly />
      </div>
    </div>

    <div class="price" *ngIf="fipePrice !== null">
      Preço FIPE: {{ fipePrice | currency:'BRL':'symbol-narrow' }}
    </div>

    <div class="actions">
      <button type="submit" [disabled]="truckForm.invalid || isLoading">
        {{ isEditMode ? 'Atualizar' : 'Salvar' }}
      </button>
      <a routerLink="/trucks" class="btn-secondary">Cancelar</a>
    </div>

    <div class="error-message" *ngIf="errorMessage">{{ errorMessage }}</div>
  </div>
</form>
